<html>
<head>
<title>Air Strike</title>
<script src="http://davealger.com/python/embedskulptor.js"></script>
</head>
<body>
<script>
(function() {
var options = {
 "gui": {
  "show": true
 },
 "console": {
  "show": false
 },
 "code": {
  "show": false
 }
};

embedSkulptor(options,(function () {/*
####################################################################################################
# PASTE YOUR PYTHON CODE BELOW
####################################################################################################

# implementation of Air Strike - a derivative of Angry Bird
# Author Hung-Tu Dinh
import simplegui
import random
# Angry bird clone
import simplegui
import math
import random 
WIDTH = 500
IMG_WIDTH = 675
GUN_A = [WIDTH*0.1 -10, WIDTH*0.9+ WIDTH/40 - 22]
GUN_B = [WIDTH*0.1 +10, WIDTH*0.9+ WIDTH/40 - 22]
CATAPULT_POS = [WIDTH*0.1 , WIDTH*0.9+ WIDTH/40]
CENTER = [0.5*(GUN_A[0]+GUN_B[0]), 0.5*(GUN_A[1]+GUN_B[1])]
BALL_RADIUS = 5
BULLET_LIMIT = 10
JET_LENGTH = 50
mouse_pos = CENTER
#ball_pos = []
#ball_pos.append(list(mouse_pos))
ball_pos = list(mouse_pos)
shooting = ball_pos
ball_vel = [0,0]
knock_down = []
G = 9.8/30 #Gravitational constant
time = 0
state= 0
target_height = WIDTH/2
target_pos = [WIDTH,target_height]
TARGET_RESET_VEL = [-1, 0]
target_vel = TARGET_RESET_VEL
trajectory = []
score = 0
stack = [ball_vel, target_vel]
pause = False
in_game = True
# Explosion 
# load 81 frame sprite sheer for explosion - image generated by phaedy explosion generator, source is hasgraphics.com
EXPLOSION_CENTER = [50, 50]
EXPLOSION_SIZE = [100, 100]
EXPLOSION_DIM = [9, 9]
explosion_image = simplegui.load_image("http://commondatastorage.googleapis.com/codeskulptor-assets/explosion.hasgraphics.png")
counter = 0
bomb = []
bomb_origin = []
bomb_counter = []
bomb_vel = []
bomb_status = False
bomb_status2 = False
explosion_index = [0,0]
ball_disappear = False
bullet_consumption = 0
# Start the ball, not the jet
def new_game():
    global mouse_pos, ball_pos, shooting, ball_vel,time, state, counter, target_vel, target_pos,target_height, ball_disappear
    mouse_pos = CENTER
    ball_pos = list(mouse_pos)
    shooting = ball_pos
    ball_vel = [0,0]
    time = 0
    state= 0
    counter = 0
    ball_trajectory_timer.stop()
    target_vel = TARGET_RESET_VEL
    target_height = random.randrange(0.25*WIDTH,0.6*WIDTH)
    ball_disappear = False
    
def draw(canvas):
    global time, target_vel, target_pos, knock_down, bomb_status, bomb_status2, in_game
    canvas.draw_image(background,(IMG_WIDTH/2,IMG_WIDTH/2),(IMG_WIDTH,IMG_WIDTH),(WIDTH/2,WIDTH/2),(WIDTH,WIDTH))
    #[176 x 510]
    canvas.draw_image(catapult,(176/2,510/2),(176,510),CATAPULT_POS,(176/5,510/7))
    canvas.draw_polyline([GUN_A, mouse_pos,GUN_B],3,"Brown")
    canvas.draw_circle(GUN_A,3,1,"Black","Black")    
    canvas.draw_circle(GUN_B,3,1,"Black","Black")
    if not ball_disappear:
        #for position in ball_pos:
        canvas.draw_circle(ball_pos,BALL_RADIUS,1,"Aqua","Red")
    
    canvas.draw_image(jet,(25, 25),(50,50),(target_pos[0],target_pos[1]),(50,50))
    
    # Hit the target: Compare the ball position with the target position
    if ball_pos[0] > target_pos[0]-JET_LENGTH/2 and ball_pos[0] < target_pos[0]+JET_LENGTH/2: # X-axis
        if ball_pos[1] > target_pos[1]-JET_LENGTH/2 and ball_pos[1] < target_pos[1]+JET_LENGTH/2: # Y-axis
            hit(canvas)  
            
            
    # Update target trajectory
    if target_pos[1] > WIDTH - JET_LENGTH/2 and target_pos[0]> GUN_B[0] + JET_LENGTH/2 and target_pos[0] < WIDTH:
        knock_down.append([target_pos[0],WIDTH - JET_LENGTH/2])  
        reset_jet()        
    else:
    # Target moving     
        target_pos[0] = target_pos[0] + target_vel[0]           
        target_pos[1] = target_pos[1] + target_vel[1]  
    
    # Bombing decision
    #if target_pos[0] < WIDTH*0.5 and not bomb_status:#and target_pos[0] < WIDTH/2 + 2:
    #    drop_bomb()
    #    bomb_status = True
    #    bomb_trajectory_timer.start()
    
    #if target_pos[0] < WIDTH*0.750 and not bomb_status2:#and target_pos[0] < WIDTH/2 + 2:
    #    drop_bomb()
    #    bomb_status2 = True
    #    bomb_trajectory_timer.start()
    
    # Jet falls out of canvas range    
    if target_pos[0] < -JET_LENGTH/2 or target_pos[0] > WIDTH or target_pos[1]< JET_LENGTH/4:
            reset_jet()
      
    # Draw knock down jets
    for jet_pos in knock_down:
        canvas.draw_image(jet,(25, 25),(50,50),(jet_pos[0],jet_pos[1]),(JET_LENGTH,JET_LENGTH))              
    
    canvas.draw_text("Score: " + str(score), [5, WIDTH/10+10], 25, "Red")
    
    # Draw bombs
    for b in bomb:
        canvas.draw_circle(b,BALL_RADIUS,1,"Aqua","Red")
    # Draw bullet storage            
    if BULLET_LIMIT-bullet_consumption > 0:
        STRENGTH_PIXEL = 80        
        canvas.draw_text("Bullets", [5, WIDTH/20], 25, "Red")        
        canvas.draw_line([STRENGTH_PIXEL, 20], [STRENGTH_PIXEL+ 2 + 10*BULLET_LIMIT, 20], 20, 'Red')
        canvas.draw_line([STRENGTH_PIXEL+2, 20], [STRENGTH_PIXEL  + (BULLET_LIMIT - bullet_consumption)*10, 20], 18, 'Green')
    else:
        canvas.draw_text("GAME OVER", [5, WIDTH/20], 25, "Red")
        in_game = False
def mousedrag(pos):
    global mouse_pos, ball_pos, shooting, ball_vel, state, bullet_consumption
    if in_game:
        # Setting the gun
        if (pos[0] <= CENTER[0] and pos[1] >= CENTER[1] and ball_disappear == False):
            state = 1    #Update the ball position by mouse     
            mouse_pos = pos
            ball_pos = list(pos)
            shooting = ball_pos
def mouseclick(pos_final):
    global mouse_pos, ball_pos, shooting, ball_vel, state, bullet_consumption
    #if 1:
    #if not pause:
    
    if(state == 1): #Shoot
        state = 2
        
        ball_trajectory_timer.start()        
        # Update ball velocity
        ball_vel[0] = 0.1*(CENTER[0] - shooting[0])
        ball_vel[1] = 0.1*(CENTER[1] - shooting[1])
        bullet_consumption = bullet_consumption + 1
        
        # Hit handler - draw the explosion        
def hit(canvas):
    global target_vel, ball_disappear, knock_down, score
    if not ball_disappear:
        score = score + 1    
    target_vel = [-2, 5]
    explosion_timer.start()
    ball_trajectory_timer.stop()
    canvas.draw_image(explosion_image, 
                        [EXPLOSION_CENTER[0] + explosion_index[0] * EXPLOSION_SIZE[0], 
                         EXPLOSION_CENTER[1] + explosion_index[1] * EXPLOSION_SIZE[1]], 
                         EXPLOSION_SIZE, target_pos, [EXPLOSION_SIZE[0]/2,EXPLOSION_SIZE[1]/2])           
    ball_disappear = True   
    
def distance(pos,target):    
    return math.sqrt((pos[0]-target[0])**2 + (pos[1]-target[1])**2)
def ball_trajectory():
    global ball_pos, time, mouse_pos
    time = time + 1
    if ball_pos[0] < WIDTH and ball_pos[1] < WIDTH: # If ball is within the canvas area        
        next_pos_x = shooting[0] + ball_vel[0]*time
        next_pos_y = shooting[1] + ball_vel[1]*time + G*time*time/2                
        ball_pos[0] = next_pos_x
        ball_pos[1] = next_pos_y
    else: # If ball falls out of the canvas area
        new_game()
        
    # Return the string, follow the ball until the ball leaves the gun
    if mouse_pos[0] < CENTER[0] and mouse_pos[1] > 1:
        mouse_pos = ball_pos
    else:
        mouse_pos = CENTER
        
    
    # Explosion
def explosion():
    global counter, explosion_index
    explosion_index = [counter % EXPLOSION_DIM[0], (counter // EXPLOSION_DIM[0]) % EXPLOSION_DIM[1]]    
    counter = counter + 1 
    if counter > 90:
        explosion_timer.stop()        
        
    #Restart the game    
def restart_button():
    global knock_down, score, bullet_consumption, in_game
    in_game = True
    knock_down = []
    new_game()    
    score = 0
    bullet_consumption = 0
    
def pause_button(): 
    global stack, ball_vel, target_vel, pause
    if (not pause):    
        pause_function()
    else:
        ball_vel = stack[0]
        target_vel = stack[1]   
        pause = False
        ball_trajectory_timer.start()
        explosion_timer.start()
def pause_function():
    global stack, ball_vel, target_vel, pause
    stack = [ball_vel, target_vel]
    ball_vel = [0, 0]
    target_vel = [0, 0]
    pause = True
    ball_trajectory_timer.stop()
    explosion_timer.stop()
        
def reset_jet():    
    global target_pos
    target_height = random.randrange(0.25*WIDTH,0.6*WIDTH)               
    if ball_disappear: # If target falls out of screen after a hit
        new_game()
    target_pos = [WIDTH,target_height] 
# Update the trajectory of multiple bombs    
def bomb_trajectory():
    global bomb, bomb_counter  
    temp = list(bomb)
    for i in range (len(bomb)):  
        # Update balls' coordinates
        bomb[i][0] = bomb_origin[i][0]+ bomb_vel[0]*bomb_counter[i]
        bomb[i][1] = bomb_origin[i][1]+ 0.5*G*bomb_counter[i]**2
        bomb_counter[i] = bomb_counter[i] + 1  
        #Bomb falls out of canvas
        if bomb[i][0]<0 or bomb[i][1] > WIDTH: 
            temp.pop(i)
            
    bomb = temp
    if len(bomb) == 0:        
        bomb_trajectory_timer.stop()
# Bombing 
def drop_bomb():
    global bomb, bomb_origin, bomb_vel, bomb_counter
    x = target_pos[0]
    y = target_pos[1]+JET_LENGTH/4
    bomb_origin.append([x,y])
    bomb.append([x,y])
    bomb_vel.append(target_vel[0])
    bomb_counter.append(0)
        
frame = simplegui.create_frame("Angry Bird Clone", WIDTH, WIDTH)
background = simplegui.load_image("http://karenfosterdesign.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/6/4/64836_putt-putt_course.jpg")
jet = simplegui.load_image("https://www.dropbox.com/s/ue8vribwat14j6a/angrybird.png?dl=1")
catapult = simplegui.load_image("http://cjonasw.files.wordpress.com/2014/03/angry-birds-catapult.png")
frame.add_button('Restart', restart_button)
#frame.add_button('Pause', pause_button)
frame.set_draw_handler(draw)
frame.set_mouseclick_handler(mouseclick)
frame.set_mousedrag_handler(mousedrag) 
frame.add_label("")
frame.add_label("Instruction")
frame.add_label("")
frame.add_label("This is a derivative of the game Angry Bird. Drag the string at the catapult, aim to the flying bird, and release the mouse to release the ball.")
frame.add_label("")
frame.add_label("Enjoy the game!")
frame.start()
ball_trajectory_timer = simplegui.create_timer(100, ball_trajectory)
bomb_trajectory_timer = simplegui.create_timer(100, bomb_trajectory)
explosion_timer = simplegui.create_timer(10, explosion)
####################################################################################################
# PASTE YOUR PYTHON CODE ABOVE
####################################################################################################
*/}).toString().match(/[^]*\/\*([^]*)\*\/\}$/)[1]);
})();
</script>

</body>
